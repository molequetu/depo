2018-11-16 13:57:12.667 +02:00 [DBG] Using idsrv as default scheme for authentication
2018-11-16 13:57:12.731 +02:00 [DBG] Using idsrv as default scheme for sign-in
2018-11-16 13:57:12.733 +02:00 [DBG] Using idsrv as default scheme for sign-out
2018-11-16 13:57:12.734 +02:00 [DBG] Using idsrv as default scheme for challenge
2018-11-16 13:57:12.734 +02:00 [DBG] Using idsrv as default scheme for forbid
2018-11-16 17:04:50.739 +02:00 [DBG] Using idsrv as default scheme for authentication
2018-11-16 17:04:50.777 +02:00 [DBG] Using idsrv as default scheme for sign-in
2018-11-16 17:04:50.777 +02:00 [DBG] Using idsrv as default scheme for sign-out
2018-11-16 17:04:50.777 +02:00 [DBG] Using idsrv as default scheme for challenge
2018-11-16 17:04:50.777 +02:00 [DBG] Using idsrv as default scheme for forbid
2018-11-16 17:04:50.921 +02:00 [DBG] Starting token cleanup
2018-11-16 17:04:57.379 +02:00 [DBG] Stopping token cleanup
2018-11-16 17:04:57.380 +02:00 [DBG] TaskCanceledException. Exiting.
2018-11-16 17:05:02.722 +02:00 [DBG] Using idsrv as default scheme for authentication
2018-11-16 17:05:02.759 +02:00 [DBG] Using idsrv as default scheme for sign-in
2018-11-16 17:05:02.759 +02:00 [DBG] Using idsrv as default scheme for sign-out
2018-11-16 17:05:02.760 +02:00 [DBG] Using idsrv as default scheme for challenge
2018-11-16 17:05:02.760 +02:00 [DBG] Using idsrv as default scheme for forbid
2018-11-16 17:05:02.900 +02:00 [DBG] Starting token cleanup
2018-11-16 17:05:12.055 +02:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-11-16 17:05:12.063 +02:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-11-16 17:05:12.063 +02:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-11-16 17:05:12.135 +02:00 [DBG] Start discovery request
2018-11-16 17:05:13.081 +02:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-11-16 17:06:06.321 +02:00 [DBG] Using idsrv as default scheme for authentication
2018-11-16 17:06:06.361 +02:00 [DBG] Using idsrv as default scheme for sign-in
2018-11-16 17:06:06.361 +02:00 [DBG] Using idsrv as default scheme for sign-out
2018-11-16 17:06:06.361 +02:00 [DBG] Using idsrv as default scheme for challenge
2018-11-16 17:06:06.361 +02:00 [DBG] Using idsrv as default scheme for forbid
2018-11-16 17:06:06.614 +02:00 [DBG] Starting token cleanup
2018-11-16 17:09:10.105 +02:00 [DBG] Using idsrv as default scheme for authentication
2018-11-16 17:09:10.156 +02:00 [DBG] Using idsrv as default scheme for sign-in
2018-11-16 17:09:10.157 +02:00 [DBG] Using idsrv as default scheme for sign-out
2018-11-16 17:09:10.157 +02:00 [DBG] Using idsrv as default scheme for challenge
2018-11-16 17:09:10.157 +02:00 [DBG] Using idsrv as default scheme for forbid
2018-11-16 17:09:10.690 +02:00 [DBG] Starting token cleanup
2018-11-16 17:10:21.781 +02:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:5002
2018-11-16 17:10:22.374 +02:00 [DBG] Origin http://localhost:5002 is allowed: true
2018-11-16 17:10:22.382 +02:00 [DBG] CorsPolicyService allowed origin: http://localhost:5002
2018-11-16 17:10:22.477 +02:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-11-16 17:10:22.480 +02:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-11-16 17:10:22.481 +02:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-11-16 17:10:22.484 +02:00 [DBG] Start discovery request
2018-11-16 17:10:23.107 +02:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-11-16 17:10:23.272 +02:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-11-16 17:10:23.286 +02:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-11-16 17:10:23.286 +02:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-11-16 17:10:23.291 +02:00 [DBG] Start authorize request
2018-11-16 17:10:23.303 +02:00 [DBG] No user present in authorize request
2018-11-16 17:10:23.308 +02:00 [DBG] Start authorize request protocol validation
2018-11-16 17:10:23.434 +02:00 [DBG] js found in database: false
2018-11-16 17:10:23.463 +02:00 [ERR] Unknown client or not enabled: js
{
  "SubjectId": "anonymous",
  "RequestedScopes": "",
  "Raw": {
    "client_id": "js",
    "redirect_uri": "http://localhost:5002/callback.html",
    "response_type": "id_token token",
    "scope": "openid profile api1",
    "state": "63ddd4b53dc14dfa94a42f77f88bc6e6",
    "nonce": "f3001cd8fdd9417da71d15b888229c7d"
  }
}
2018-11-16 17:10:23.468 +02:00 [ERR] Request validation failed
2018-11-16 17:10:23.468 +02:00 [INF] {
  "SubjectId": "anonymous",
  "RequestedScopes": "",
  "Raw": {
    "client_id": "js",
    "redirect_uri": "http://localhost:5002/callback.html",
    "response_type": "id_token token",
    "scope": "openid profile api1",
    "state": "63ddd4b53dc14dfa94a42f77f88bc6e6",
    "nonce": "f3001cd8fdd9417da71d15b888229c7d"
  }
}
2018-11-16 17:10:23.507 +02:00 [INF] {
  "Name": "Token Issued Failure",
  "Category": "Token",
  "EventType": "Failure",
  "Id": 2001,
  "ClientId": "js",
  "Endpoint": "Authorize",
  "Scopes": "",
  "Error": "unauthorized_client",
  "ActivityId": "0HLIBQLR7RGCF:00000002",
  "TimeStamp": "2018-11-16T15:10:23Z",
  "ProcessId": 14992,
  "LocalIpAddress": "127.0.0.1:15812",
  "RemoteIpAddress": "::1"
}
2018-11-16 17:11:54.803 +02:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:5002
2018-11-16 17:11:54.818 +02:00 [DBG] Origin http://localhost:5002 is allowed: true
2018-11-16 17:11:54.818 +02:00 [DBG] CorsPolicyService allowed origin: http://localhost:5002
2018-11-16 17:11:54.818 +02:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-11-16 17:11:54.818 +02:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-11-16 17:11:54.819 +02:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-11-16 17:11:54.819 +02:00 [DBG] Start discovery request
2018-11-16 17:11:54.823 +02:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-11-16 17:11:54.838 +02:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-11-16 17:11:54.839 +02:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-11-16 17:11:54.839 +02:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-11-16 17:11:54.839 +02:00 [DBG] Start authorize request
2018-11-16 17:11:54.839 +02:00 [DBG] No user present in authorize request
2018-11-16 17:11:54.839 +02:00 [DBG] Start authorize request protocol validation
2018-11-16 17:11:55.081 +02:00 [DBG] spa found in database: true
2018-11-16 17:11:55.134 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:11:55.195 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:11:55.214 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:11:55.217 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:11:55.228 +02:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-11-16 17:11:55.230 +02:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "spa",
  "ClientName": "Depo web spa client",
  "RedirectUri": "http://localhost:5002/callback.html",
  "AllowedRedirectUris": [
    "http://localhost:5002/callback.html",
    "http://localhost:5002/index.html",
    "http://localhost:5002/silent.html",
    "http://localhost:5002/popup.html"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile api1",
  "State": "1604da85c80a48fd88bfab37d997acf3",
  "Nonce": "59c8babe73c04dc2bcd28c1c4a2043ff",
  "Raw": {
    "client_id": "spa",
    "redirect_uri": "http://localhost:5002/callback.html",
    "response_type": "id_token token",
    "scope": "openid profile api1",
    "state": "1604da85c80a48fd88bfab37d997acf3",
    "nonce": "59c8babe73c04dc2bcd28c1c4a2043ff"
  }
}
2018-11-16 17:11:55.241 +02:00 [INF] Showing login: User is not authenticated
2018-11-16 17:11:55.319 +02:00 [DBG] Start authorize request protocol validation
2018-11-16 17:11:55.325 +02:00 [DBG] spa found in database: true
2018-11-16 17:11:55.327 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:11:55.330 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:11:55.332 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:11:55.335 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:11:55.335 +02:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-11-16 17:11:55.345 +02:00 [DBG] spa found in database: true
2018-11-16 17:12:09.554 +02:00 [DBG] CORS request made for path: /account/login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-11-16 17:12:09.630 +02:00 [DBG] Start authorize request protocol validation
2018-11-16 17:12:09.634 +02:00 [DBG] spa found in database: true
2018-11-16 17:12:09.637 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:12:09.641 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:12:09.643 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:12:09.646 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:12:09.647 +02:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-11-16 17:12:09.654 +02:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Username": "alice",
  "SubjectId": "818727",
  "DisplayName": "alice",
  "Endpoint": "UI",
  "ActivityId": "0HLIBQLR7RGCM:00000002",
  "TimeStamp": "2018-11-16T15:12:09Z",
  "ProcessId": 14992,
  "LocalIpAddress": "127.0.0.1:15812",
  "RemoteIpAddress": "::1"
}
2018-11-16 17:12:09.678 +02:00 [DBG] Augmenting SignInContext
2018-11-16 17:12:09.680 +02:00 [DBG] Adding idp claim with value: local
2018-11-16 17:12:09.680 +02:00 [DBG] Adding amr claim with value: pwd
2018-11-16 17:12:09.693 +02:00 [INF] AuthenticationScheme: idsrv signed in.
2018-11-16 17:12:09.697 +02:00 [DBG] spa found in database: true
2018-11-16 17:12:09.710 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:09.710 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:09.710 +02:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-11-16 17:12:09.711 +02:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-11-16 17:12:09.711 +02:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-11-16 17:12:09.718 +02:00 [DBG] Start authorize callback request
2018-11-16 17:12:09.736 +02:00 [DBG] User in authorize request: 818727
2018-11-16 17:12:09.736 +02:00 [DBG] Start authorize request protocol validation
2018-11-16 17:12:09.740 +02:00 [DBG] spa found in database: true
2018-11-16 17:12:09.743 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:12:09.746 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:12:09.747 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:12:09.750 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:12:09.750 +02:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-11-16 17:12:09.751 +02:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "spa",
  "ClientName": "Depo web spa client",
  "RedirectUri": "http://localhost:5002/callback.html",
  "AllowedRedirectUris": [
    "http://localhost:5002/callback.html",
    "http://localhost:5002/index.html",
    "http://localhost:5002/silent.html",
    "http://localhost:5002/popup.html"
  ],
  "SubjectId": "818727",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile api1",
  "State": "1604da85c80a48fd88bfab37d997acf3",
  "Nonce": "59c8babe73c04dc2bcd28c1c4a2043ff",
  "SessionId": "729364cd2e5c8ed892c204cd2e0f4144",
  "Raw": {
    "client_id": "spa",
    "redirect_uri": "http://localhost:5002/callback.html",
    "response_type": "id_token token",
    "scope": "openid profile api1",
    "state": "1604da85c80a48fd88bfab37d997acf3",
    "nonce": "59c8babe73c04dc2bcd28c1c4a2043ff"
  }
}
2018-11-16 17:12:09.752 +02:00 [DBG] IsActive called from: AuthorizeEndpoint
2018-11-16 17:12:09.799 +02:00 [DBG] b3hu0okmcq3jUle30FnDFZMCDEuAXDFht+uStSTPgIE= found in database: false
2018-11-16 17:12:09.799 +02:00 [DBG] user_consent grant with value: spa|818727 not found in store.
2018-11-16 17:12:09.800 +02:00 [DBG] Found no prior consent from consent store, consent is required
2018-11-16 17:12:09.800 +02:00 [INF] Showing consent: User has not yet consented
2018-11-16 17:12:09.811 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:09.811 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:09.857 +02:00 [DBG] Start authorize request protocol validation
2018-11-16 17:12:09.861 +02:00 [DBG] spa found in database: true
2018-11-16 17:12:09.863 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:12:09.866 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:12:09.868 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:12:09.871 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:12:09.871 +02:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-11-16 17:12:09.874 +02:00 [DBG] spa found in database: true
2018-11-16 17:12:09.877 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:12:09.879 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:12:10.318 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:10.318 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:10.318 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:10.318 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:10.318 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:10.319 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:10.344 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:10.344 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:10.452 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:10.454 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:10.502 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:10.502 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:10.589 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:10.590 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:20.334 +02:00 [DBG] CORS request made for path: /consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-11-16 17:12:20.335 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:20.335 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:20.438 +02:00 [DBG] Start authorize request protocol validation
2018-11-16 17:12:20.442 +02:00 [DBG] spa found in database: true
2018-11-16 17:12:20.445 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:12:20.448 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:12:20.450 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:12:20.453 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:12:20.453 +02:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-11-16 17:12:20.464 +02:00 [INF] {
  "Name": "Consent granted",
  "Category": "Grants",
  "EventType": "Information",
  "Id": 4000,
  "SubjectId": "818727",
  "ClientId": "spa",
  "RequestedScopes": [
    "openid",
    "profile",
    "api1"
  ],
  "GrantedScopes": [
    "openid",
    "profile",
    "api1"
  ],
  "ConsentRemembered": true,
  "ActivityId": "0HLIBQLR7RGCM:00000004",
  "TimeStamp": "2018-11-16T15:12:20Z",
  "ProcessId": 14992,
  "LocalIpAddress": "127.0.0.1:15812",
  "RemoteIpAddress": "::1"
}
2018-11-16 17:12:20.481 +02:00 [DBG] spa found in database: true
2018-11-16 17:12:20.491 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:20.492 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:20.492 +02:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-11-16 17:12:20.492 +02:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-11-16 17:12:20.492 +02:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-11-16 17:12:20.492 +02:00 [DBG] Start authorize callback request
2018-11-16 17:12:20.502 +02:00 [DBG] User in authorize request: 818727
2018-11-16 17:12:20.502 +02:00 [DBG] Start authorize request protocol validation
2018-11-16 17:12:20.511 +02:00 [DBG] spa found in database: true
2018-11-16 17:12:20.514 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:12:20.518 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:12:20.520 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:12:20.524 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:12:20.524 +02:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-11-16 17:12:20.525 +02:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "spa",
  "ClientName": "Depo web spa client",
  "RedirectUri": "http://localhost:5002/callback.html",
  "AllowedRedirectUris": [
    "http://localhost:5002/callback.html",
    "http://localhost:5002/index.html",
    "http://localhost:5002/silent.html",
    "http://localhost:5002/popup.html"
  ],
  "SubjectId": "818727",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile api1",
  "State": "1604da85c80a48fd88bfab37d997acf3",
  "Nonce": "59c8babe73c04dc2bcd28c1c4a2043ff",
  "SessionId": "729364cd2e5c8ed892c204cd2e0f4144",
  "Raw": {
    "client_id": "spa",
    "redirect_uri": "http://localhost:5002/callback.html",
    "response_type": "id_token token",
    "scope": "openid profile api1",
    "state": "1604da85c80a48fd88bfab37d997acf3",
    "nonce": "59c8babe73c04dc2bcd28c1c4a2043ff"
  }
}
2018-11-16 17:12:20.525 +02:00 [DBG] IsActive called from: AuthorizeEndpoint
2018-11-16 17:12:20.528 +02:00 [DBG] b3hu0okmcq3jUle30FnDFZMCDEuAXDFht+uStSTPgIE= found in database: false
2018-11-16 17:12:20.528 +02:00 [DBG] user_consent grant with value: spa|818727 not found in store.
2018-11-16 17:12:20.528 +02:00 [DBG] Found no prior consent from consent store, consent is required
2018-11-16 17:12:20.535 +02:00 [INF] User consented to scopes: ["openid","profile","api1"]
2018-11-16 17:12:20.537 +02:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","api1"]
2018-11-16 17:12:20.543 +02:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: 818727
2018-11-16 17:12:20.561 +02:00 [DBG] b3hu0okmcq3jUle30FnDFZMCDEuAXDFht+uStSTPgIE= not found in database
2018-11-16 17:12:20.767 +02:00 [DBG] Creating Implicit Flow response.
2018-11-16 17:12:20.783 +02:00 [DBG] Getting claims for access token for client: spa
2018-11-16 17:12:20.783 +02:00 [DBG] Getting claims for access token for subject: 818727
2018-11-16 17:12:20.789 +02:00 [DBG] Get profile called for subject 818727 from client Depo web spa client with claim types [] via ClaimsProviderAccessToken
2018-11-16 17:12:20.791 +02:00 [DBG] Issued claims: []
2018-11-16 17:12:20.907 +02:00 [DBG] Getting claims for identity token for subject: 818727 and client: spa
2018-11-16 17:12:20.907 +02:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-11-16 17:12:20.926 +02:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "spa",
  "ClientName": "Depo web spa client",
  "RedirectUri": "http://localhost:5002/callback.html",
  "Endpoint": "Authorize",
  "SubjectId": "818727",
  "Scopes": "openid profile api1",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****54Jg"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****3ZwQ"
    }
  ],
  "ActivityId": "0HLIBQLR7RGCL:00000005",
  "TimeStamp": "2018-11-16T15:12:20Z",
  "ProcessId": 14992,
  "LocalIpAddress": "127.0.0.1:15812",
  "RemoteIpAddress": "::1"
}
2018-11-16 17:12:20.930 +02:00 [INF] Authorize endpoint response
{
  "SubjectId": "818727",
  "ClientId": "spa",
  "RedirectUri": "http://localhost:5002/callback.html",
  "State": "1604da85c80a48fd88bfab37d997acf3",
  "Scope": "openid profile api1"
}
2018-11-16 17:12:20.950 +02:00 [DBG] Augmenting SignInContext
2018-11-16 17:12:20.951 +02:00 [INF] AuthenticationScheme: idsrv signed in.
2018-11-16 17:12:59.382 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:59.382 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:59.420 +02:00 [DBG] Start authorize request protocol validation
2018-11-16 17:12:59.426 +02:00 [DBG] spa found in database: true
2018-11-16 17:12:59.430 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:12:59.433 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:12:59.438 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:12:59.442 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:12:59.442 +02:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-11-16 17:12:59.446 +02:00 [DBG] spa found in database: true
2018-11-16 17:12:59.448 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:12:59.454 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:12:59.524 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:59.524 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:59.527 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:59.533 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:59.563 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:59.564 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:59.564 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:59.564 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:59.697 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:59.699 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:59.899 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:12:59.899 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:00.024 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:00.025 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:02.830 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:02.830 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:03.116 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:03.116 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:03.116 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:03.116 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:03.162 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:03.163 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:03.167 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:03.199 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:03.315 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:03.315 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:03.426 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:03.426 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:03.564 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:03.564 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:05.367 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:05.367 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:05.471 +02:00 [DBG] 1 persisted grants found for 818727
2018-11-16 17:13:05.498 +02:00 [DBG] spa found in database: true
2018-11-16 17:13:05.502 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:13:05.506 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:13:05.740 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:05.740 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:05.747 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:05.748 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:05.787 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:05.787 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:05.789 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:05.790 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:05.896 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:05.896 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:06.132 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:06.132 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:11.748 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:11.748 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:11.831 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:11.831 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:11.831 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:11.831 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:11.874 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:11.874 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:11.894 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:11.894 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:12.090 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:12.090 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:12.090 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:12.090 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:12.142 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:12.143 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:13.237 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:13.238 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:13.484 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:13.484 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:13.498 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:13.498 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:13.497 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:13.526 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:13.622 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:13.623 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:13.627 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:13.628 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:13.824 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:13.824 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:15.313 +02:00 [DBG] CORS request made for path: /Account/Logout from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-11-16 17:13:15.313 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:15.313 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:15.364 +02:00 [INF] AuthenticationScheme: idsrv signed out.
2018-11-16 17:13:15.370 +02:00 [INF] {
  "Name": "User Logout Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1002,
  "SubjectId": "818727",
  "DisplayName": "alice",
  "ActivityId": "0HLIBQLR7RGCO:00000003",
  "TimeStamp": "2018-11-16T15:13:15Z",
  "ProcessId": 14992,
  "LocalIpAddress": "127.0.0.1:15812",
  "RemoteIpAddress": "::1"
}
2018-11-16 17:13:15.722 +02:00 [DBG] Request path /connect/endsession/callback matched to endpoint type Endsession
2018-11-16 17:13:15.727 +02:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionCallbackEndpoint
2018-11-16 17:13:15.728 +02:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionCallbackEndpoint for /connect/endsession/callback
2018-11-16 17:13:15.800 +02:00 [DBG] Processing signout callback request
2018-11-16 17:13:15.839 +02:00 [DBG] spa found in database: true
2018-11-16 17:13:15.839 +02:00 [DBG] No client front-channel logout URLs
2018-11-16 17:13:15.840 +02:00 [DBG] No client back-channel logout URLs
2018-11-16 17:13:15.840 +02:00 [INF] Successful signout callback.
2018-11-16 17:13:15.840 +02:00 [DBG] No client front-channel iframe urls
2018-11-16 17:13:15.840 +02:00 [DBG] No client back-channel iframe urls
2018-11-16 17:13:20.788 +02:00 [INF] AuthenticationScheme: idsrv was challenged.
2018-11-16 17:13:51.261 +02:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:5002
2018-11-16 17:13:51.264 +02:00 [DBG] Origin http://localhost:5002 is allowed: true
2018-11-16 17:13:51.264 +02:00 [DBG] CorsPolicyService allowed origin: http://localhost:5002
2018-11-16 17:13:51.265 +02:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-11-16 17:13:51.265 +02:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-11-16 17:13:51.265 +02:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-11-16 17:13:51.265 +02:00 [DBG] Start discovery request
2018-11-16 17:13:51.270 +02:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-11-16 17:13:51.288 +02:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-11-16 17:13:51.288 +02:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-11-16 17:13:51.289 +02:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-11-16 17:13:51.289 +02:00 [DBG] Start authorize request
2018-11-16 17:13:51.289 +02:00 [DBG] No user present in authorize request
2018-11-16 17:13:51.289 +02:00 [DBG] Start authorize request protocol validation
2018-11-16 17:13:51.294 +02:00 [DBG] spa found in database: true
2018-11-16 17:13:51.297 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:13:51.302 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:13:51.304 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:13:51.308 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:13:51.308 +02:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-11-16 17:13:51.308 +02:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "spa",
  "ClientName": "Depo web spa client",
  "RedirectUri": "http://localhost:5002/callback.html",
  "AllowedRedirectUris": [
    "http://localhost:5002/callback.html",
    "http://localhost:5002/index.html",
    "http://localhost:5002/silent.html",
    "http://localhost:5002/popup.html"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile api1",
  "State": "7964b7660a544fb4b6faac011f1032c9",
  "Nonce": "223fa666ab5e403e8133750c9e8ac648",
  "Raw": {
    "client_id": "spa",
    "redirect_uri": "http://localhost:5002/callback.html",
    "response_type": "id_token token",
    "scope": "openid profile api1",
    "state": "7964b7660a544fb4b6faac011f1032c9",
    "nonce": "223fa666ab5e403e8133750c9e8ac648"
  }
}
2018-11-16 17:13:51.308 +02:00 [INF] Showing login: User is not authenticated
2018-11-16 17:13:51.353 +02:00 [DBG] Start authorize request protocol validation
2018-11-16 17:13:51.358 +02:00 [DBG] spa found in database: true
2018-11-16 17:13:51.361 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:13:51.364 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:13:51.367 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:13:51.371 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:13:51.371 +02:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-11-16 17:13:51.375 +02:00 [DBG] spa found in database: true
2018-11-16 17:13:57.773 +02:00 [DBG] CORS request made for path: /account/login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-11-16 17:13:57.869 +02:00 [DBG] Start authorize request protocol validation
2018-11-16 17:13:57.873 +02:00 [DBG] spa found in database: true
2018-11-16 17:13:57.881 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:13:57.890 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:13:57.895 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:13:57.907 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:13:57.907 +02:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-11-16 17:13:57.908 +02:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Username": "alice",
  "SubjectId": "818727",
  "DisplayName": "alice",
  "Endpoint": "UI",
  "ActivityId": "0HLIBQLR7RGCO:0000000A",
  "TimeStamp": "2018-11-16T15:13:57Z",
  "ProcessId": 14992,
  "LocalIpAddress": "127.0.0.1:15812",
  "RemoteIpAddress": "::1"
}
2018-11-16 17:13:57.908 +02:00 [DBG] Augmenting SignInContext
2018-11-16 17:13:57.908 +02:00 [DBG] Adding idp claim with value: local
2018-11-16 17:13:57.908 +02:00 [DBG] Adding amr claim with value: pwd
2018-11-16 17:13:57.908 +02:00 [INF] AuthenticationScheme: idsrv signed in.
2018-11-16 17:13:57.913 +02:00 [DBG] spa found in database: true
2018-11-16 17:13:57.971 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:57.972 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:13:57.972 +02:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-11-16 17:13:57.973 +02:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-11-16 17:13:57.973 +02:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-11-16 17:13:57.973 +02:00 [DBG] Start authorize callback request
2018-11-16 17:13:57.973 +02:00 [DBG] User in authorize request: 818727
2018-11-16 17:13:57.973 +02:00 [DBG] Start authorize request protocol validation
2018-11-16 17:13:57.978 +02:00 [DBG] spa found in database: true
2018-11-16 17:13:57.982 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:13:57.987 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:13:57.990 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:13:57.994 +02:00 [DBG] Found ["api1"] API scopes in database
2018-11-16 17:13:57.994 +02:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-11-16 17:13:57.994 +02:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "spa",
  "ClientName": "Depo web spa client",
  "RedirectUri": "http://localhost:5002/callback.html",
  "AllowedRedirectUris": [
    "http://localhost:5002/callback.html",
    "http://localhost:5002/index.html",
    "http://localhost:5002/silent.html",
    "http://localhost:5002/popup.html"
  ],
  "SubjectId": "818727",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile api1",
  "State": "7964b7660a544fb4b6faac011f1032c9",
  "Nonce": "223fa666ab5e403e8133750c9e8ac648",
  "SessionId": "ac1becd5b6254b45bffbd672607a6c10",
  "Raw": {
    "client_id": "spa",
    "redirect_uri": "http://localhost:5002/callback.html",
    "response_type": "id_token token",
    "scope": "openid profile api1",
    "state": "7964b7660a544fb4b6faac011f1032c9",
    "nonce": "223fa666ab5e403e8133750c9e8ac648"
  }
}
2018-11-16 17:13:57.994 +02:00 [DBG] IsActive called from: AuthorizeEndpoint
2018-11-16 17:13:57.998 +02:00 [DBG] b3hu0okmcq3jUle30FnDFZMCDEuAXDFht+uStSTPgIE= found in database: true
2018-11-16 17:13:58.006 +02:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-11-16 17:13:58.006 +02:00 [DBG] Creating Implicit Flow response.
2018-11-16 17:13:58.006 +02:00 [DBG] Getting claims for access token for client: spa
2018-11-16 17:13:58.006 +02:00 [DBG] Getting claims for access token for subject: 818727
2018-11-16 17:13:58.006 +02:00 [DBG] Get profile called for subject 818727 from client Depo web spa client with claim types [] via ClaimsProviderAccessToken
2018-11-16 17:13:58.006 +02:00 [DBG] Issued claims: []
2018-11-16 17:13:58.010 +02:00 [DBG] Getting claims for identity token for subject: 818727 and client: spa
2018-11-16 17:13:58.011 +02:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-11-16 17:13:58.016 +02:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "spa",
  "ClientName": "Depo web spa client",
  "RedirectUri": "http://localhost:5002/callback.html",
  "Endpoint": "Authorize",
  "SubjectId": "818727",
  "Scopes": "openid profile api1",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****oeSQ"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****JUSw"
    }
  ],
  "ActivityId": "0HLIBQLR7RGCL:00000015",
  "TimeStamp": "2018-11-16T15:13:58Z",
  "ProcessId": 14992,
  "LocalIpAddress": "127.0.0.1:15812",
  "RemoteIpAddress": "::1"
}
2018-11-16 17:13:58.016 +02:00 [INF] Authorize endpoint response
{
  "SubjectId": "818727",
  "ClientId": "spa",
  "RedirectUri": "http://localhost:5002/callback.html",
  "State": "7964b7660a544fb4b6faac011f1032c9",
  "Scope": "openid profile api1"
}
2018-11-16 17:13:58.016 +02:00 [DBG] Augmenting SignInContext
2018-11-16 17:13:58.017 +02:00 [INF] AuthenticationScheme: idsrv signed in.
2018-11-16 17:13:59.687 +02:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:5002
2018-11-16 17:13:59.690 +02:00 [DBG] Origin http://localhost:5002 is allowed: true
2018-11-16 17:13:59.690 +02:00 [DBG] CorsPolicyService allowed origin: http://localhost:5002
2018-11-16 17:13:59.690 +02:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-11-16 17:13:59.691 +02:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-11-16 17:13:59.691 +02:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-11-16 17:13:59.691 +02:00 [DBG] Start discovery request
2018-11-16 17:13:59.697 +02:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-11-16 17:14:00.003 +02:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:5002
2018-11-16 17:14:00.008 +02:00 [DBG] Origin http://localhost:5002 is allowed: true
2018-11-16 17:14:00.008 +02:00 [DBG] CorsPolicyService allowed origin: http://localhost:5002
2018-11-16 17:14:00.008 +02:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-11-16 17:14:00.009 +02:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-11-16 17:14:00.009 +02:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-11-16 17:14:00.013 +02:00 [DBG] Start key discovery request
2018-11-16 17:14:00.310 +02:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:5002
2018-11-16 17:14:00.320 +02:00 [DBG] Origin http://localhost:5002 is allowed: true
2018-11-16 17:14:00.321 +02:00 [DBG] CorsPolicyService allowed origin: http://localhost:5002
2018-11-16 17:14:00.592 +02:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:5002
2018-11-16 17:14:00.599 +02:00 [DBG] Origin http://localhost:5002 is allowed: true
2018-11-16 17:14:00.599 +02:00 [DBG] CorsPolicyService allowed origin: http://localhost:5002
2018-11-16 17:14:00.599 +02:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-11-16 17:14:00.600 +02:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-11-16 17:14:00.600 +02:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-11-16 17:14:00.618 +02:00 [DBG] Start userinfo request
2018-11-16 17:14:00.624 +02:00 [DBG] Bearer token found in header
2018-11-16 17:14:00.771 +02:00 [DBG] spa found in database: true
2018-11-16 17:14:00.786 +02:00 [DBG] spa found in database: true
2018-11-16 17:14:00.788 +02:00 [DBG] IsActive called from: AccessTokenValidation
2018-11-16 17:14:00.791 +02:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-11-16 17:14:00.799 +02:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1542381238,
    "exp": 1542384838,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "api1"
    ],
    "client_id": "spa",
    "sub": "818727",
    "auth_time": 1542381237,
    "idp": "local",
    "scope": [
      "openid",
      "profile",
      "api1"
    ],
    "amr": "pwd"
  }
}
2018-11-16 17:14:00.801 +02:00 [DBG] IsActive called from: UserInfoRequestValidation
2018-11-16 17:14:00.810 +02:00 [DBG] Creating userinfo response
2018-11-16 17:14:00.817 +02:00 [DBG] Scopes in access token: openid profile api1
2018-11-16 17:14:00.823 +02:00 [DBG] Scopes in access token: openid profile api1
2018-11-16 17:14:00.837 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:14:00.839 +02:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at
2018-11-16 17:14:00.839 +02:00 [DBG] Scopes in access token: openid profile api1
2018-11-16 17:14:00.852 +02:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-11-16 17:14:00.853 +02:00 [DBG] Get profile called for subject 818727 from client Depo web spa client with claim types ["sub","name","family_name","given_name","middle_name","nickname","preferred_username","profile","picture","website","gender","birthdate","zoneinfo","locale","updated_at"] via UserInfoEndpoint
2018-11-16 17:14:00.856 +02:00 [DBG] Issued claims: ["name","given_name","family_name","website"]
2018-11-16 17:14:00.856 +02:00 [INF] Profile service returned to the following claim types: name given_name family_name website
2018-11-16 17:14:00.857 +02:00 [DBG] End userinfo request
2018-11-16 17:14:00.985 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:14:00.985 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:14:00.985 +02:00 [DBG] Request path /connect/checksession matched to endpoint type Checksession
2018-11-16 17:14:00.986 +02:00 [DBG] Endpoint enabled: Checksession, successfully created handler: IdentityServer4.Endpoints.CheckSessionEndpoint
2018-11-16 17:14:00.986 +02:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.CheckSessionEndpoint for /connect/checksession
2018-11-16 17:14:00.987 +02:00 [DBG] Rendering check session result
2018-11-16 17:14:02.139 +02:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:5002
2018-11-16 17:14:02.260 +02:00 [DBG] Origin http://localhost:5002 is allowed: true
2018-11-16 17:14:02.260 +02:00 [DBG] CorsPolicyService allowed origin: http://localhost:5002
2018-11-16 17:14:02.260 +02:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-11-16 17:14:02.260 +02:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-11-16 17:14:02.260 +02:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-11-16 17:14:02.260 +02:00 [DBG] Start discovery request
2018-11-16 17:14:02.285 +02:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-11-16 17:14:02.561 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:14:02.561 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:14:02.561 +02:00 [DBG] Request path /connect/checksession matched to endpoint type Checksession
2018-11-16 17:14:02.562 +02:00 [DBG] Endpoint enabled: Checksession, successfully created handler: IdentityServer4.Endpoints.CheckSessionEndpoint
2018-11-16 17:14:02.562 +02:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.CheckSessionEndpoint for /connect/checksession
2018-11-16 17:14:02.562 +02:00 [DBG] Rendering check session result
2018-11-16 17:14:14.063 +02:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-11-16 17:14:14.063 +02:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-11-16 17:14:14.063 +02:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-11-16 17:14:14.063 +02:00 [DBG] Start discovery request
2018-11-16 17:14:14.069 +02:00 [DBG] Found ["openid","profile","api1"] as all scopes in database
2018-11-16 17:14:14.232 +02:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-11-16 17:14:14.232 +02:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-11-16 17:14:14.232 +02:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-11-16 17:14:14.232 +02:00 [DBG] Start key discovery request
2018-11-16 17:14:23.687 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:14:23.687 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:14:23.687 +02:00 [DBG] Request path /connect/endsession matched to endpoint type Endsession
2018-11-16 17:14:23.688 +02:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionEndpoint
2018-11-16 17:14:23.688 +02:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession
2018-11-16 17:14:23.698 +02:00 [DBG] Processing signout request for 818727
2018-11-16 17:14:23.706 +02:00 [DBG] Start end session request validation
2018-11-16 17:14:23.715 +02:00 [DBG] Start identity token validation
2018-11-16 17:14:23.720 +02:00 [DBG] spa found in database: true
2018-11-16 17:14:23.720 +02:00 [DBG] Client found: spa / Depo web spa client
2018-11-16 17:14:23.723 +02:00 [DBG] IsActive called from: IdentityTokenValidation
2018-11-16 17:14:23.723 +02:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-11-16 17:14:23.723 +02:00 [DBG] Token validation success
{
  "ClientId": "spa",
  "ClientName": "Depo web spa client",
  "ValidateLifetime": false,
  "Claims": {
    "nbf": 1542381238,
    "exp": 1542381538,
    "iss": "http://localhost:5000",
    "aud": "spa",
    "nonce": "223fa666ab5e403e8133750c9e8ac648",
    "iat": 1542381238,
    "at_hash": "cm1E4vEeoTUH_dq5xRofCw",
    "sid": "ac1becd5b6254b45bffbd672607a6c10",
    "sub": "818727",
    "auth_time": 1542381237,
    "idp": "local",
    "amr": "pwd"
  }
}
2018-11-16 17:14:23.729 +02:00 [INF] End session request validation success
{
  "ClientId": "spa",
  "ClientName": "Depo web spa client",
  "SubjectId": "818727",
  "PostLogOutUri": "http://localhost:5002/index.html",
  "Raw": {
    "id_token_hint": "eyJhbGciOiJSUzI1NiIsImtpZCI6IjViNjgwMjI5OTcxNDBhMmYzNDc0Y2FmNWMxNTRmMmY4IiwidHlwIjoiSldUIn0.eyJuYmYiOjE1NDIzODEyMzgsImV4cCI6MTU0MjM4MTUzOCwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo1MDAwIiwiYXVkIjoic3BhIiwibm9uY2UiOiIyMjNmYTY2NmFiNWU0MDNlODEzMzc1MGM5ZThhYzY0OCIsImlhdCI6MTU0MjM4MTIzOCwiYXRfaGFzaCI6ImNtMUU0dkVlb1RVSF9kcTV4Um9mQ3ciLCJzaWQiOiJhYzFiZWNkNWI2MjU0YjQ1YmZmYmQ2NzI2MDdhNmMxMCIsInN1YiI6IjgxODcyNyIsImF1dGhfdGltZSI6MTU0MjM4MTIzNywiaWRwIjoibG9jYWwiLCJhbXIiOlsicHdkIl19.IEt-jGET41Cjmup8gDl0_mcr7_M05XWwSACXJICu8b1_IR2_9nJfoR0txASFPbqsfv49oDHTrSwxFk9L2G18oGzOaAADND1xGaAgUZ19ray0ciM3lA5gotM_5gq6Qeqx90BS0jhT9GZcz5mWCyFof5D_xoqF1nGHZOdtKkTloIOMj9FQU7XZaiNjzEG2rarQPvSU2nLgOV5cdMQvUdxo0mKDrK1qPcGLoDaVe9EZ_S7Oa2Ds30WL_5bDBbKyp04JeYPXoX9zv-dzDNUVTCiXRq5aV5EbxY-vJ6pXsKP3yHC3xFSxGgG-Cvqb_PNoVdFTSWb-R1XtyEjC6pCpAWoeSQ",
    "post_logout_redirect_uri": "http://localhost:5002/index.html"
  }
}
2018-11-16 17:14:23.730 +02:00 [DBG] Success validating end session request from spa
2018-11-16 17:14:23.754 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:14:23.754 +02:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-11-16 17:14:23.790 +02:00 [INF] AuthenticationScheme: idsrv signed out.
2018-11-16 17:14:23.791 +02:00 [INF] {
  "Name": "User Logout Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1002,
  "SubjectId": "818727",
  "DisplayName": "alice",
  "ActivityId": "0HLIBQLR7RGCK:0000001B",
  "TimeStamp": "2018-11-16T15:14:23Z",
  "ProcessId": 14992,
  "LocalIpAddress": "127.0.0.1:15812",
  "RemoteIpAddress": "::1"
}
2018-11-16 17:14:24.033 +02:00 [DBG] Request path /connect/endsession/callback matched to endpoint type Endsession
2018-11-16 17:14:24.034 +02:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionCallbackEndpoint
2018-11-16 17:14:24.034 +02:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionCallbackEndpoint for /connect/endsession/callback
2018-11-16 17:14:24.034 +02:00 [DBG] Processing signout callback request
2018-11-16 17:14:24.075 +02:00 [DBG] spa found in database: true
2018-11-16 17:14:24.075 +02:00 [DBG] No client front-channel logout URLs
2018-11-16 17:14:24.075 +02:00 [DBG] No client back-channel logout URLs
2018-11-16 17:14:24.075 +02:00 [INF] Successful signout callback.
2018-11-16 17:14:24.075 +02:00 [DBG] No client front-channel iframe urls
2018-11-16 17:14:24.075 +02:00 [DBG] No client back-channel iframe urls
